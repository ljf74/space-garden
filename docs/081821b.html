<style>canvas{display:inline-block;height:100%;width:100%;image-rendering:pixelated;image-rendering:crisp-edges;background-color:#000}</style><section id=game></section><script>!function(){var e=function(t,e,i){return this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=23,this.cursorColor2=25,this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.colors=[0,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610],this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.clear=function(t,e){this.ram.fill(t,e,e+this.PAGESIZE)},this};e.prototype.setPen=function(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i},e.prototype.pset=function(t,e,i,s=64){i=(0|i)%64;let a=(e|=0)%4*4+(t|=0)%4,n=this.pat&Math.pow(2,a)?i:s;64!=n&&(0>t|t>this.WIDTH-1||0>e|e>this.HEIGHT-1||(this.ram[this.renderTarget+e*this.WIDTH+t]=n))},e.prototype.pget=function(t,e,i=0){return t|=0,e|=0,this.ram[i+t+e*this.WIDTH]},e.prototype.line=function(t,e,i,s,a){var n,r,h=(s|=0)-(e|=0),o=(i|=0)-(t|=0);if(0>h?(h=-h,r=-1):r=1,0>o?(o=-o,n=-1):n=1,h<<=1,o<<=1,this.pset(t,e,a),o>h)for(var l=h-(o>>1);t!=i;)0>l||(e+=r,l-=o),t+=n,l+=h,this.pset(t,e,a);else for(l=o-(h>>1);e!=s;)0>l||(t+=n,l-=h),e+=r,l+=o,this.pset(t,e,a)},e.prototype.circle=function(t,e,i,s){t|=0,e|=0,s|=0;var a=-(i|=0),n=0,r=2-2*i;do{this.pset(t-a,e+n,s),this.pset(t-n,e-a,s),this.pset(t+a,e-n,s),this.pset(t+n,e+a,s),(i=r)>n||(r+=2*++n+1),(i>a||r>n)&&(r+=2*++a+1)}while(0>a)},e.prototype.fillCircle=function(t,e,i,s){if(t|=0,e|=0,s|=0,(i|=0)>=0){t|=0,e|=0;var a=-(i|=0),n=0,r=2-2*i;do{this.line(t-a,e-n,t+a,e-n,s),this.line(t-a,e+n,t+a,e+n,s),(i=r)>n||(r+=2*++n+1),(i>a||r>n)&&(r+=2*++a+1)}while(0>a)}},e.prototype.rect=function(t,e,i,s,a){a|=this.cursorColor;let n=0|t,r=0|e,h=t+i|0,o=e+s|0;this.line(n,r,h,r,a),this.line(h,r,h,o,a),this.line(n,o,h,o,a),this.line(n,r,n,o,a)},e.prototype.fillRect=function(t,e,i,s,a){let n=0|t,r=0|e,h=(t+i|0)-1,o=(e+s|0)-1;a=a;var l=Math.abs(o-r);if(this.line(n,r,h,r,a),l>0)for(;--l;)this.line(n,r+l,h,r+l,a);this.line(n,o,h,o,a)},e.prototype.sspr=function(t=0,e=0,i=16,s=16,a=0,n=0,r=32,h=32,o=!1,l=!1){var d=i/r,p=s/h;this.pat=this.dither[0];for(var u=0;h>u;u++)for(var c=0;r>c;c++)px=c*d|0,py=u*p|0,e=l?s-py-u:e,t=o?i-px-c:t,this.pset(a+c,n+u,this.pget(t+px,e+py,this.renderSource))},e.prototype.outline=(t,e,i,s,a,n)=>{for(let r=0;r<=WIDTH;r++)for(let h=0;h<=HEIGHT;h++){let o=r-1+h*WIDTH,l=r+1+h*WIDTH,d=r+(h+1)*WIDTH,p=r+(h-1)*WIDTH,u=r+h*WIDTH;ram[t+u]&&(ram[t+o]||(ram[e+o]=i),ram[t+l]||(ram[e+l]=a),ram[t+p]||(ram[e+p]=s),ram[t+d]||(ram[e+d]=n))}},e.prototype.triangle=function(t,e,i,s){this.line(t.x,t.y,e.x,e.y,s),this.line(e.x,e.y,i.x,i.y,s),this.line(i.x,i.y,t.x,t.y,s)},e.prototype.fillTriangle=function(t,e,i,s){let a=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),n=a[0],r=a[1],h=a[2],o=0,l=0,d=0,p={},u={};if(r.y-n.y>0&&(o=(r.x-n.x)/(r.y-n.y)),h.y-n.y>0&&(l=(h.x-n.x)/(h.y-n.y)),h.y-r.y>0&&(d=(h.x-r.x)/(h.y-r.y)),Object.assign(p,n),Object.assign(u,n),o>l){for(;p.y<=r.y;p.y++,u.y++,p.x+=l,u.x+=o)this.line(p.x,p.y,u.x,p.y,s);for(u=r;p.y<=h.y;p.y++,u.y++,p.x+=l,u.x+=d)this.line(p.x,p.y,u.x,p.y,s)}else{for(;p.y<=r.y;p.y++,u.y++,p.x+=o,u.x+=l)this.line(p.x,p.y,u.x,p.y,s);for(p=r;p.y<=h.y;p.y++,u.y++,p.x+=d,u.x+=l)this.line(p.x,p.y,u.x,p.y,s)}},e.prototype.imageToRam=(t,e)=>{let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let s=i.getContext("2d");s.drawImage(t,0,0);var a=s.getImageData(0,0,WIDTH,HEIGHT);let n=new Uint32Array(a.data.buffer);for(var r=0;r<n.length;r++)ram[e+r]=colors.indexOf(n[r])},e.prototype.render=function(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.ctx.putImageData(this.imageData,0,0)},e.prototype.textLine=function(t){for(var e=t[0].length,i=0;e>i;i++){var s;s=this.getCharacter(t[0].charAt(i));for(var a=0;5>a;a++)for(var n=0;5>n;n++)if(1==s[5*a+n])if(1==t[4])this.pset(t[1]+n*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[5]);else{let e=t[1]+n*t[4]+(5*t[4]+t[3])*i,s=t[2]+a*t[4]|0;this.fillRect(e,s,t[4],t[4],t[5])}}},e.prototype.text=function(t){var e=5*t[7],i=t[0].split("\n"),s=i.slice(0),a=i.length,n=s.sort((t,e)=>e.length-t.length)[0],r=n.length*e+(n.length-1)*t[3],h=a*e+(a-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var o=t[1],l=t[2],d=t[1]+r,p=t[2]+h;"center"==t[5]?(o=t[1]-r/2,d=t[1]+r/2):"right"==t[5]&&(o=t[1]-r,d=t[1]),"center"==t[6]?(l=t[2]-h/2,p=t[2]+h/2):"bottom"==t[6]&&(l=t[2]-h,p=t[2]);for(var u=o+r/2,c=l+h/2,f=0;a>f;f++){var y=i[f],x=y.length*e+(y.length-1)*t[3],w=t[1],g=t[2]+(e+t[4])*f;"center"==t[5]?w=t[1]-x/2:"right"==t[5]&&(w=t[1]-x),"center"==t[6]?g-=h/2:"bottom"==t[6]&&(g-=h),this.textLine([y,w,g,t[3],t[7],t[8]])}return{sx:o,sy:l,cx:u,cy:c,ex:d,ey:p,width:r,height:h}},e.prototype.getCharacter=function(t){return index=this.fontString.indexOf(t),this.fontBitmap.substring(25*index,25*index+25).split("")};var i=function(){var t,e,i,s,a,n=t=>Math.sin(6.283184*t),r=t=>.003959503758*2**((t-128)/12),h=(t,e,i)=>{var s,a,n,h,l,d,p=o[t.i[0]],u=t.i[1],c=t.i[3]/32,f=o[t.i[4]],y=t.i[5],x=t.i[8]/32,w=t.i[9],g=t.i[10]*t.i[10]*4,m=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,M=1/v,E=-t.i[13]/16,D=t.i[14],I=i*2**(2-t.i[15]),S=new Int32Array(g+m+v),T=0,A=0;for(s=0,a=0;g+m+v>s;s++,a++)0>a||(a-=I,l=r(e+(15&(D=D>>8|(255&D)<<4))+t.i[2]-128),d=r(e+(15&D)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,g>s?n=s/g:g+m>s||(n=(1-(n=(s-g-m)*M))*3**(E*n)),h=p(T+=l*n**c)*u,h+=f(A+=d*n**x)*y,w&&(h+=(2*Math.random()-1)*w),S[s]=80*h*n|0;return S},o=[n,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=n=>{t=n,e=n.endPattern,i=0,s=n.rowLen*n.patternLen*(e+1)*2,a=new Int32Array(s)},this.generate=()=>{var r,l,d,p,u,c,f,y,x,w,g,m,v,M,E=new Int32Array(s),D=t.songData[i],I=t.rowLen,S=t.patternLen,T=0,A=0,C=!1,P=[];for(d=0;e>=d;++d)for(f=D.p[d],p=0;S>p;++p){var H=f?D.c[f-1].f[p]:0;H&&(D.i[H-1]=D.c[f-1].f[p+S]||0,17>H&&(P=[]));var G=o[D.i[16]],R=D.i[17]/512,b=2**(D.i[18]-9)/I,L=D.i[19],V=D.i[20],W=135.82764118168*D.i[21]/44100,O=1-D.i[22]/255,U=1e-5*D.i[23],N=D.i[24]/32,j=D.i[25]/512,k=6.283184*2**(D.i[26]-9)/I,_=D.i[27]/255,Z=D.i[28]*I&-2;for(g=(d*S+p)*I,u=0;4>u;++u)if(c=f?D.c[f-1].n[p+u*S]:0){P[c]||(P[c]=h(D,c,I));var B=P[c];for(l=0,r=2*g;l<B.length;l++,r+=2)E[r]+=B[l]}for(l=0;I>l;l++)(w=E[y=2*(g+l)])||C?(m=W,L&&(m*=G(b*y)*R+.5),A+=(m=1.5*Math.sin(m))*(v=O*(w-A)-(T+=m*A)),w=3==V?A:1==V?v:T,U&&(w=1>(w*=U)?w>-1?n(.25*w):-1:1,w/=U),C=(w*=N)*w>1e-5,M=w*(1-(x=Math.sin(k*y)*j+.5)),w*=x):M=0,Z>y||(M+=E[y-Z+1]*_,w+=E[y-Z]*_),E[y]=0|M,E[y+1]=0|w,a[y]+=0|M,a[y+1]+=0|w}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,s/2,44100),i=0;2>i;i++)for(var n=e.getChannelData(i),r=i;s>r;r+=2)n[r>>1]=a[r]/65536;return e},this.createWave=()=>{var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,r=44;s>n;++n){var h=a[n];h=-32767>h?-32767:h>32767?32767:h,i[r++]=255&h,i[r++]=h>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),s=Array(e),n=0;2*e>n;n+=1){var r=i+n;s[n]=t>0&&r<a.length?a[r]/32768:0}return s}},s={songData:[{i:[0,192,128,0,0,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,0,16,0,16,170,6,25,6],p:[1,2,1,2,1,2,1,2,1,1],c:[{n:[123,,,,,,135,,,,,,,,133,,,,133,,,,133,,,,130,,133,,135],f:[]},{n:[123,,,,,,135,,,,,,,,133],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,1,,1,1,1,1,1,1],c:[{n:[135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[]}]},{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[,,,,1,2,1,2,3,4],c:[{n:[,,,,130,,,,,,130,,,,,,,,128,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,133],f:[]},{n:[,,,,123,,,,,,123,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,123,,,,,,130,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,130,,,,,,130,,,,,,,,130,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:3},a={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1};function n(t,e=0){return t.x-view.x+e>0&&t.y-view.y+e>0&&t.x-view.x-e<w&&t.y-view.y-e<h}function o(t,e=1,i=0,s=.5,a=!1){var n=window.audioCtx.createBufferSource(),r=window.audioCtx.createGain(),h=window.audioCtx.createStereoPanner();return n.buffer=t,n.connect(h),h.connect(r),r.connect(audioMaster),n.playbackRate.value=e,n.loop=a,r.gain.value=s,h.pan.value=i,n.start(),{volume:r,sound:n}}const l={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};function d(t,e,i,s){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=s}d.prototype.draw=function(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]},d.prototype.update=function(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)},Player={x:0,y:0,radius:8,color:4,colliding:!1,withinPlanetGravity:!1,hitPlanet:!1,inAir:!1,chargingJump:!1,canJump:!1,canDoubleJump:!1,planet:null,py:0,px:0,angle:0,planetAngle:0,runSpeed:.9,turnSpeed:.1,baseJumpSpeed:2,jumpSpeed:2,thrust:.02,yVel:0,xVel:0,draw(){r.fillCircle(this.x-view.x,this.y-view.y,this.radius,this.color),r.pset(this.x-view.x+Math.cos(this.angle)*(this.radius+2),this.y-view.y+Math.sin(this.angle)*(this.radius+2),22),debugTxt=`${this.withinPlanetGravity}\n\nXV ${this.xVel}\n\nYV ${this.yVel}\n\nJS ${this.jumpSpeed}\n\nVX ${view.x} VY ${view.y}\n\n`.toUpperCase(),r.text([debugTxt,5,5,1,1,"left","top",1,22])},update(){if(this.y+=this.yVel,this.x+=this.xVel,this.hitPlanet&&(splodes.push(new d(this.x,this.y,40,7)),this.hitPlanet=!1),this.planet){let t=this.planet.x-p.x,e=this.planet.y-p.y,i=Math.sqrt(t*t+e*e);i<this.planet.radius+this.radius||(this.colliding=!1),i<this.planet.field+this.radius||(this.withinPlanetGravity=!1),i>this.planet.radius||(this.colliding=!0),this.withinPlanetGravity&&(this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.planetAngle=Math.atan2(this.py,this.px),this.xVel-=Math.cos(this.planetAngle)*this.planet.gravity,this.yVel-=Math.sin(this.planetAngle)*this.planet.gravity)}if(this.colliding?(this.color=7,this.yVel=0,this.xVel=0):this.color=4,l.isDown(l.LEFT)||l.isDown(l.q)||l.isDown(l.a)?this.moveLeft():(l.isDown(l.RIGHT)||l.isDown(l.d))&&this.moveRight(),l.isDown(l.UP)||l.isDown(l.z)||l.isDown(l.w)?this.moveUp():(l.isDown(l.DOWN)||l.isDown(l.w))&&this.moveDown(),l.justReleased(l.SPACE)){for(let t=10;t>0;t--)splodes.push(new d(p.x+20*Math.random()-10,p.y+20*Math.random()-10,70*Math.random(),100*Math.random()));playSound(sounds.cellComplete)}},moveLeft(){this.colliding?(this.xVel-=Math.cos(this.planetAngle+Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle+Math.PI/2)*this.runSpeed):this.angle-=this.turnSpeed},moveRight(){this.colliding?(this.xVel-=Math.cos(this.planetAngle-Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle-Math.PI/2)*this.runSpeed):this.angle+=this.turnSpeed},moveUp(){this.colliding?(this.xVel+=Math.cos(this.planetAngle)*this.jumpSpeed,this.yVel+=Math.sin(this.planetAngle)*this.jumpSpeed):(this.xVel+=Math.cos(this.angle)*this.thrust,this.yVel+=Math.sin(this.angle)*this.thrust)},moveDown(){this.colliding?this.jumpSpeed+=.01:(this.xVel-=Math.cos(this.angle)*this.thrust,this.yVel-=Math.sin(this.angle)*this.thrust)},onPlanet(t){this.planet=t,this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.angle=Math.atan2(this.py,this.px),this.withinPlanetGravity=!0}};const u=Player;function c(t,e,i,s){return this.x=t,this.y=e,this.radius=i,this.field=this.radius+30,this.color=s,this.gravity=.1,this}function f(t,e,i,s){this.x=t,this.y=e,this.radius=i,this.alive=!0,this.color=s,this.drawStack=[];for(let t=0;20>t;t++)this.drawStack.push({x:this.x+(2*Math.random()-1)*this.radius,y:this.y+(2*Math.random()-1)*this.radius,w:Math.random()*this.radius,h:Math.random()*this.radius,color:this.color+3*Math.random()});return this}function g(){for(let t=0;150>t;t++){let t=new c;t.x=Math.floor(6e3*Math.random()),t.y=Math.floor(6e3*Math.random()),t.radius=Math.floor(100*Math.random())+20,t.field=t.radius+Math.floor(20*Math.random())+30,t.color=Math.floor(64*Math.random()),planets.push(t)}for(let t=0;1e4>t;t++)stars.push({x:Math.floor(6e3*Math.random()),y:Math.floor(6e3*Math.random()),c:Math.floor(5*Math.random())+18});for(let t=0;5e4>t;t++)stars.push({x:Math.floor(6e3*Math.random()),y:Math.floor(6e3*Math.random()),c:Math.floor(3*Math.random())});planets.push(new c(mw-70,mh,40,53)),planets.push(new c(mw+100,mh,70,54));for(let t=0;100>t;t++)artifacts.push(new f(Math.floor(6e3*Math.random()),Math.floor(6e3*Math.random()),Math.floor(20*Math.random()),Math.floor(63*Math.random())))}function m(){console.log("audio initializing"),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),sndData=[{name:"song",data:s},{name:"cellComplete",data:a}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{var e=new i;e.init(t.data);var s=!1;setInterval(()=>{if(!s&&(s=1==e.generate(),soundsReady+=s,s)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)})}function v(t){for(let e=0;e<t.length;e++)t[e].alive||t.splice(e,1)}c.prototype.draw=function(){n(this,200)&&(r.fillCircle(this.x-view.x,this.y-view.y,this.radius,this.color),r.circle(this.x-view.x,this.y-view.y,this.field,1))},c.prototype.update=function(){if(n(this,200)){let t=this.x-p.x,e=this.y-p.y;Math.sqrt(t*t+e*e)>this.field+p.radius||p.withinPlanetGravity||p.onPlanet(this)}},f.prototype.draw=function(){n(this,200)&&this.drawStack.forEach(t=>{r.fillRect(t.x-view.x,t.y-view.y,t.w,t.h,t.color)})},f.prototype.update=function(){if(n(this,200)){let t=this.x-p.x,e=this.y-p.y;if(Math.sqrt(t*t+e*e)<=this.radius+p.radius){this.alive=!1;for(let t=10;t>0;t--)splodes.push(new d(p.x+20*Math.random()-10,p.y+20*Math.random()-10,70*Math.random(),100*Math.random()));playSound(sounds.cellComplete),collected.push(this)}}},w=Math.floor(innerWidth/3),h=Math.floor(innerHeight/3),view={x:0,y:0},mw=w/2,mh=h/2,k=[],gamestate=0,paused=!1,p=u,p.x=3e3,p.y=3e3,r=new e(w,h,3),window.playSound=o,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),window.t=1,splodes=[],planets=[],sndData=[],stars=[],collected=[],artifacts=[],sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="",window.addEventListener("keyup",t=>{l.onKeyup(t)},!1),window.addEventListener("keydown",t=>{l.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),onclick=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0==soundsReady?(g(),m()):soundsReady==totalSounds&&(gamestate=1,o(sounds.song,1,0,.3,!0))}},function e(){switch(gamestate){case 0:r.clear(0,r.SCREEN),splodes.forEach(t=>{t.draw()}),r.text(["UNTITLED SPACE GAME",w/2-2,50,1,3,"center","top",3,7]),r.text([audioTxt,w/2-2,90,1,3,"center","top",1,22]),(l.justReleased(l.UP)||l.justReleased(l.w)||l.justReleased(l.z))&&(0==soundsReady?(g(),m()):(o(sounds.song,1,0,.3,!0),gamestate=1)),soundsReady==totalSounds?audioTxt="ALL SOUNDS LOADED.\nCLICK OR PRESS UP/W/Z TO CONTINUE":soundsReady>0?audioTxt="SOUNDS LOADING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nLOADING SEQUENCE",r.render();break;case 1:t+=1,view.x=p.x-mw,view.y=p.y-mh,splodes.forEach(t=>t.update()),planets.forEach(t=>t.update()),artifacts.forEach(t=>t.update()),p.update(),v(splodes),v(artifacts),r.clear(0,r.SCREEN),r.renderTarget=r.SCREEN,stars.forEach(t=>{n(t)&&r.pset(t.x-view.x,t.y-view.y,t.c)}),planets.forEach(t=>t.draw()),splodes.forEach(t=>t.draw()),artifacts.forEach(t=>t.draw()),p.draw(),collected.forEach((t,e)=>{r.rect(5+20*e,h-20,10,10,22),r.fillRect(5+20*e,h-20,10,10,t.color)}),r.render();break;case 2:gameover()}l.update(),requestAnimationFrame(e)}()}();</script>