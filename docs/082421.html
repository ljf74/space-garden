<style>body{background-color:black}canvas{display:inline-block;height:100%;width:100%;image-rendering:pixelated;image-rendering:crisp-edges;background-color:#000}</style><section id=game></section><script>!function(){var e=function(t,e,i,a){return this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=a,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=23,this.cursorColor2=25,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.clear=function(t,e){this.ram.fill(t,e,e+this.PAGESIZE)},this};e.prototype.setPen=function(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i},e.prototype.pset=function(t,e,i,a=64){i=(0|i)%64;let s=this.pat&Math.pow(2,(e|=0)%4*4+(t|=0)%4)?i:a;64!=s&&(0>t|t>this.WIDTH-1||0>e|e>this.HEIGHT-1||(this.ram[this.renderTarget+e*this.WIDTH+t]=s))},e.prototype.pget=function(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]},e.prototype.line=function(t,e,i,a,s){var r,h,n=(a|=0)-(e|=0),o=(i|=0)-(t|=0);if(0>n?(n=-n,h=-1):h=1,0>o?(o=-o,r=-1):r=1,n<<=1,o<<=1,this.pset(t,e,s),o>n)for(var l=n-(o>>1);t!=i;)0>l||(e+=h,l-=o),l+=n,this.pset(t+=r,e,s);else for(l=o-(n>>1);e!=a;)0>l||(t+=r,l-=n),l+=o,this.pset(t,e+=h,s)},e.prototype.tline=function(t,e,i,a,s=0,r=0,h=0){var n,o,l=(a|=0)-(e|=0),d=(i|=0)-(t|=0);0>l?(l=-l,o=-1):o=1,0>d?(d=-d,n=-1):n=1;for(var p=t,u=e,c=(l<<=1)-((d<<=1)>>1);p!=i;)0>c||(u+=o,c-=d),c+=l,this.pset(p+=n,u,this.pget(p-s,u-r,this.renderSource)+h)},e.prototype.circle=function(t,e,i,a){t|=0,e|=0,a|=0;var s=-(i|=0),r=0,h=2-2*i;do{this.pset(t-s,e+r,a),this.pset(t-r,e-s,a),this.pset(t+s,e-r,a),this.pset(t+r,e+s,a),(i=h)>r||(h+=2*++r+1),(i>s||h>r)&&(h+=2*++s+1)}while(0>s)},e.prototype.fillCircle=function(t,e,i,a){if(t|=0,e|=0,a|=0,(i|=0)>=0){t|=0,e|=0;var s=-(i|=0),r=0,h=2-2*i;do{this.line(t-s,e-r,t+s,e-r,a),this.line(t-s,e+r,t+s,e+r,a),(i=h)>r||(h+=2*++r+1),(i>s||h>r)&&(h+=2*++s+1)}while(0>s)}},e.prototype.tfillCircle=function(t,e,i,a=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var s=-(i|=0),r=0,h=2-2*i;do{this.tline(t-s,e-r,t+s,e-r,offX,offY,a),this.tline(t-s,e+r,t+s,e+r,offX,offY,a),(i=h)>r||(h+=2*++r+1),(i>s||h>r)&&(h+=2*++s+1)}while(0>s)}},e.prototype.rect=function(t,e,i,a,s){let r=0|t,h=0|e,n=t+i|0,o=e+a|0;this.line(r,h,n,h,s|=this.cursorColor),this.line(n,h,n,o,s),this.line(r,o,n,o,s),this.line(r,h,r,o,s)},e.prototype.fillRect=function(t,e,i,a,s){let r=0|t,h=0|e,n=(t+i|0)-1,o=(e+a|0)-1;s=s;var l=Math.abs(o-h);if(this.line(r,h,n,h,s),l>0)for(;--l;)this.line(r,h+l,n,h+l,s);this.line(r,o,n,o,s)},e.prototype.sspr=function(t=0,e=0,i=16,a=16,s=0,r=0,h=32,n=32,o=!1,l=!1){var d=i/h,p=a/n;this.pat=this.dither[0];for(var u=0;n>u;u++)for(var c=0;h>c;c++)px=c*d|0,py=u*p|0,e=l?a-py-u:e,t=o?i-px-c:t,this.pset(s+c,r+u,this.pget(t+px,e+py,this.renderSource))},e.prototype.outline=(t,e,i,a,s,r)=>{for(let h=0;h<=WIDTH;h++)for(let n=0;n<=HEIGHT;n++){let o=h-1+n*WIDTH,l=h+1+n*WIDTH,d=h+(n+1)*WIDTH,p=h+(n-1)*WIDTH,u=h+n*WIDTH;ram[t+u]&&(ram[t+o]||(ram[e+o]=i),ram[t+l]||(ram[e+l]=s),ram[t+p]||(ram[e+p]=a),ram[t+d]||(ram[e+d]=r))}},e.prototype.triangle=function(t,e,i,a){this.line(t.x,t.y,e.x,e.y,a),this.line(e.x,e.y,i.x,i.y,a),this.line(i.x,i.y,t.x,t.y,a)},e.prototype.fillTriangle=function(t,e,i,a){let s=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),r=s[0],h=s[1],n=s[2],o=0,l=0,d=0,p={},u={};if(h.y-r.y>0&&(o=(h.x-r.x)/(h.y-r.y)),n.y-r.y>0&&(l=(n.x-r.x)/(n.y-r.y)),n.y-h.y>0&&(d=(n.x-h.x)/(n.y-h.y)),Object.assign(p,r),Object.assign(u,r),o>l){for(;h.y>=p.y;p.y++,u.y++,p.x+=l,u.x+=o)this.line(p.x,p.y,u.x,p.y,a);for(u=h;n.y>=p.y;p.y++,u.y++,p.x+=l,u.x+=d)this.line(p.x,p.y,u.x,p.y,a)}else{for(;h.y>=p.y;p.y++,u.y++,p.x+=o,u.x+=l)this.line(p.x,p.y,u.x,p.y,a);for(p=h;n.y>=p.y;p.y++,u.y++,p.x+=d,u.x+=l)this.line(p.x,p.y,u.x,p.y,a)}},e.prototype.imageToRam=(t,e)=>{let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let a=i.getContext("2d");a.drawImage(t,0,0);var s=a.getImageData(0,0,WIDTH,HEIGHT);let r=new Uint32Array(s.data.buffer);for(var h=0;r.length>h;h++)ram[e+h]=colors.indexOf(r[h])},e.prototype.render=function(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.ctx.putImageData(this.imageData,0,0)},e.prototype.textLine=function(t){for(var e=t[0].length,i=0;e>i;i++){var a;a=this.getCharacter(t[0].charAt(i));for(var s=0;5>s;s++)for(var r=0;5>r;r++)1==a[5*s+r]&&(1==t[4]?this.pset(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+s*t[4]|0,t[5]):this.fillRect(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+s*t[4]|0,t[4],t[4],t[5]))}},e.prototype.text=function(t){var e=5*t[7],i=t[0].split("\n"),a=i.slice(0),s=i.length,r=a.sort((t,e)=>e.length-t.length)[0],h=r.length*e+(r.length-1)*t[3],n=s*e+(s-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var o=t[1],l=t[2],d=t[1]+h,p=t[2]+n;"center"==t[5]?(o=t[1]-h/2,d=t[1]+h/2):"right"==t[5]&&(o=t[1]-h,d=t[1]),"center"==t[6]?(l=t[2]-n/2,p=t[2]+n/2):"bottom"==t[6]&&(l=t[2]-n,p=t[2]);for(var u=o+h/2,c=l+n/2,f=0;s>f;f++){var y=i[f],g=y.length*e+(y.length-1)*t[3],m=t[1],x=t[2]+(e+t[4])*f;"center"==t[5]?m=t[1]-g/2:"right"==t[5]&&(m=t[1]-g),"center"==t[6]?x-=n/2:"bottom"==t[6]&&(x-=n),this.textLine([y,m,x,t[3],t[7],t[8]])}return{sx:o,sy:l,cx:u,cy:c,ex:d,ey:p,width:h,height:n}},e.prototype.getCharacter=function(t){return index=this.fontString.indexOf(t),this.fontBitmap.substring(25*index,25*index+25).split("")};var i=function(){var t,e,i,a,s,r=t=>Math.sin(6.283184*t),h=t=>.003959503758*2**((t-128)/12),n=(t,e,i)=>{var a,s,r,n,l,d,p=o[t.i[0]],u=t.i[1],c=t.i[3]/32,f=o[t.i[4]],y=t.i[5],g=t.i[8]/32,m=t.i[9],x=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,M=t.i[12]*t.i[12]*4,v=1/M,E=-t.i[13]/16,A=t.i[14],I=i*2**(2-t.i[15]),D=new Int32Array(x+w+M),S=0,T=0;for(a=0,s=0;x+w+M>a;a++,s++)0>s||(s-=I,l=h(e+(15&(A=A>>8|(255&A)<<4))+t.i[2]-128),d=h(e+(15&A)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,x>a?r=a/x:x+w>a||(r=(1-(r=(a-x-w)*v))*3**(E*r)),n=p(S+=l*r**c)*u,n+=f(T+=d*r**g)*y,m&&(n+=(2*Math.random()-1)*m),D[a]=80*n*r|0;return D},o=[r,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=r=>{t=r,i=0,a=r.rowLen*r.patternLen*((e=r.endPattern)+1)*2,s=new Int32Array(a)},this.generate=()=>{var h,l,d,p,u,c,f,y,g,m,x,w,M,v,E=new Int32Array(a),A=t.songData[i],I=t.rowLen,D=t.patternLen,S=0,T=0,P=!1,b=[];for(d=0;e>=d;++d)for(f=A.p[d],p=0;D>p;++p){var C=f?A.c[f-1].f[p]:0;C&&(A.i[C-1]=A.c[f-1].f[p+D]||0,17>C&&(b=[]));var G=o[A.i[16]],H=A.i[17]/512,R=2**(A.i[18]-9)/I,L=A.i[19],O=A.i[20],W=135.82764118168*A.i[21]/44100,V=1-A.i[22]/255,U=1e-5*A.i[23],k=A.i[24]/32,N=A.i[25]/512,_=6.283184*2**(A.i[26]-9)/I,Z=A.i[27]/255,j=A.i[28]*I&-2;for(x=(d*D+p)*I,u=0;4>u;++u)if(c=f?A.c[f-1].n[p+u*D]:0){b[c]||(b[c]=n(A,c,I));var B=b[c];for(l=0,h=2*x;B.length>l;l++,h+=2)E[h]+=B[l]}for(l=0;I>l;l++)(m=E[y=2*(x+l)])||P?(w=W,L&&(w*=G(R*y)*H+.5),T+=(w=1.5*Math.sin(w))*(M=V*(m-T)-(S+=w*T)),m=3==O?T:1==O?M:S,U&&(m=1>(m*=U)?m>-1?r(.25*m):-1:1,m/=U),P=(m*=k)*m>1e-5,v=m*(1-(g=Math.sin(_*y)*N+.5)),m*=g):v=0,j>y||(v+=E[y-j+1]*Z,m+=E[y-j]*Z),E[y]=0|v,E[y+1]=0|m,s[y]+=0|v,s[y+1]+=0|m}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,a/2,44100),i=0;2>i;i++)for(var r=e.getChannelData(i),h=i;a>h;h+=2)r[h>>1]=s[h]/65536;return e},this.createWave=()=>{var t=44+2*a-8,e=t-36,i=new Uint8Array(44+2*a);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,h=44;a>r;++r){var n=s[r];i[h++]=255&(n=-32767>n?-32767:n>32767?32767:n),i[h++]=n>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),a=Array(e),r=0;2*e>r;r+=1){var h=i+r;a[r]=t>0&&s.length>h?s[h]/32768:0}return a}},a={songData:[{i:[0,192,128,0,0,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,0,16,0,16,170,6,25,6],p:[1,2,1,2,1,2,1,2,1,1],c:[{n:[123,,,,,,135,,,,,,,,133,,,,133,,,,133,,,,130,,133,,135],f:[]},{n:[123,,,,,,135,,,,,,,,133],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,1,,1,1,1,1,1,1],c:[{n:[135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[]}]},{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[,,,,1,2,1,2,3,4],c:[{n:[,,,,130,,,,,,130,,,,,,,,128,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,133],f:[]},{n:[,,,,123,,,,,,123,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,123,,,,,,130,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,130,,,,,,130,,,,,,,,130,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:3},s={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1};function n(t,e=0){return t.x-view.x+e>0&&t.y-view.y+e>0&&t.x-view.x-e<w&&t.y-view.y-e<h}function o(t,e=1,i=0,a=.5,s=!1){var r=window.audioCtx.createBufferSource(),h=window.audioCtx.createGain(),n=window.audioCtx.createStereoPanner();return r.buffer=t,r.connect(n),n.connect(h),h.connect(audioMaster),r.playbackRate.value=e,r.loop=s,h.gain.value=a,n.pan.value=i,r.start(),{volume:h,sound:r}}const l={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};function d(t,e,i,a){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=a}d.prototype.draw=function(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]},d.prototype.update=function(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)},Player={x:0,y:0,radius:8,color:4,colliding:!1,withinPlanetGravity:!1,hitPlanet:!1,inAir:!1,chargingJump:!1,canJump:!1,canDoubleJump:!1,planet:null,py:0,px:0,angle:0,bodyAngle:0,planetAngle:0,runSpeed:.9,turnSpeed:.1,baseJumpSpeed:2,jumpSpeed:2,thrust:.02,yVel:0,xVel:0,draw(){let t=this.x-view.x,e=this.y-view.y,i=Math.PI/6,a=t+Math.cos(this.angle)*(this.radius+2),s=e+Math.sin(this.angle)*(this.radius+2),h=t+Math.cos(this.angle)*(this.radius+7),n=e+Math.sin(this.angle)*(this.radius+7),o=t+Math.cos(this.bodyAngle)*this.radius,l=e+Math.sin(this.bodyAngle)*this.radius,d=t+Math.cos(this.bodyAngle+5*i)*this.radius,p=e+Math.sin(this.bodyAngle+5*i)*this.radius,u=t+Math.cos(this.bodyAngle-5*i)*this.radius,c=e+Math.sin(this.bodyAngle-5*i)*this.radius;r.circle(t,e,this.radius,1),r.line(a,s,h,n,7),r.fillCircle(o,l,2,22),r.pset(d,p,22),r.pset(u,c,22),debugTxt=`JS ${this.jumpSpeed}\n`.toUpperCase(),r.text([debugTxt,5,5,1,1,"left","top",1,22])},update(){if(this.y+=this.yVel,this.x+=this.xVel,this.bodyAngle=this.angle-Math.PI/2,this.hitPlanet&&(splodes.push(new d(this.x,this.y,40,7)),this.hitPlanet=!1),this.planet){let t=this.planet.x-p.x,e=this.planet.y-p.y,i=Math.sqrt(t*t+e*e);this.planet.radius+this.radius>i||(this.colliding=!1),this.planet.field+this.radius>i||(this.withinPlanetGravity=!1),i>this.planet.radius||(this.colliding=!0),this.withinPlanetGravity&&(this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.planetAngle=Math.atan2(this.py,this.px),this.xVel-=Math.cos(this.planetAngle)*this.planet.gravity,this.yVel-=Math.sin(this.planetAngle)*this.planet.gravity)}if(this.colliding?(this.color=7,this.yVel=0,this.xVel=0,this.bodyAngle=this.planetAngle):this.color=4,l.isDown(l.LEFT)||l.isDown(l.q)||l.isDown(l.a)?this.moveLeft():(l.isDown(l.RIGHT)||l.isDown(l.d))&&this.moveRight(),l.isDown(l.UP)||l.isDown(l.z)||l.isDown(l.w)?this.moveUp():(l.isDown(l.DOWN)||l.isDown(l.w))&&this.moveDown(),l.justReleased(l.SPACE)){for(let t=10;t>0;t--)splodes.push(new d(p.x+20*Math.random()-10,p.y+20*Math.random()-10,70*Math.random(),100*Math.random()));playSound(sounds.cellComplete)}},moveLeft(){this.colliding?(this.xVel-=Math.cos(this.planetAngle+Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle+Math.PI/2)*this.runSpeed):this.angle-=this.turnSpeed},moveRight(){this.colliding?(this.xVel-=Math.cos(this.planetAngle-Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle-Math.PI/2)*this.runSpeed):this.angle+=this.turnSpeed},moveUp(){var t,e;this.colliding?(this.xVel+=Math.cos(this.planetAngle)*this.jumpSpeed,this.yVel+=Math.sin(this.planetAngle)*this.jumpSpeed):(this.xVel+=Math.cos(this.angle)*this.thrust,this.yVel+=Math.sin(this.angle)*this.thrust,Math.random(),Math.random(),splodes.push(new d(this.x+Math.cos(this.angle+Math.PI)*(this.radius+2)+2*Math.random(),this.y+Math.sin(this.angle+Math.PI)*(this.radius+2)+2*Math.random(),20,(t=[7,8,22])[(e=t.length-1,Math.floor(Math.random()*(e+1-0)+0))])))},moveDown(){this.colliding?this.jumpSpeed+=.01:(this.xVel-=Math.cos(this.angle)*this.thrust,this.yVel-=Math.sin(this.angle)*this.thrust)},onPlanet(t){this.planet=t,this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.angle=Math.atan2(this.py,this.px),this.withinPlanetGravity=!0}};const u=Player;function c(){return this.x=0,this.y=0,this.radius=5,this.field=this.radius+30,this.color=22,this.palette=[0,1,2,3,4,5,6],this.gravity=.1,this}function f(t,e,i,a){this.x=t,this.y=e,this.radius=i,this.alive=!0,this.color=a,this.drawStack=[];for(let t=0;20>t;t++)this.drawStack.push({x:this.x+(2*Math.random()-1)*this.radius,y:this.y+(2*Math.random()-1)*this.radius,w:Math.random()*this.radius,h:Math.random()*this.radius,color:this.color+3*Math.random()});return this}function g(){for(let t=0;170>t;t++){let t=new c;t.x=Math.floor(6e3*Math.random()),t.y=Math.floor(6e3*Math.random()),t.radius=Math.floor(Math.random()*((h-15)/2))+10,t.field=t.radius+Math.floor(20*Math.random())+30;let e=Math.floor(55*Math.random());t.color=e,planets.push(t)}for(let t=0;1e4>t;t++)stars.push({x:Math.floor(6e3*Math.random()),y:Math.floor(6e3*Math.random()),c:Math.floor(5*Math.random())+18});for(let t=0;5e4>t;t++)stars.push({x:Math.floor(6e3*Math.random()),y:Math.floor(6e3*Math.random()),c:Math.floor(3*Math.random())});for(let t=0;100>t;t++)artifacts.push(new f(Math.floor(6e3*Math.random()),Math.floor(6e3*Math.random()),Math.floor(20*Math.random()),Math.floor(63*Math.random())));r.renderTarget=r.PAGE_2,r.pal=r.palDefault,r.fillRect(0,0,w,h,1);for(let t=0;5e3>t;t++)r.pat=r.dither[Math.floor(15*Math.random())],r.fillCircle(Math.random()*w,Math.random()*h,4*Math.random(),Math.floor(5*Math.random()));for(let t=0;500>t;t++)r.pat=r.dither[Math.floor(15*Math.random())],r.fillCircle(Math.random()*w,Math.random()*h,20*Math.random(),Math.floor(7*Math.random()));r.pat=r.dither[0],r.line(mw,mh-10,mw,mh+10,0),r.line(mw-10,mh,mw+10,mh,0),r.renderTarget=r.SCREEN}function m(){console.log("audio initializing"),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),sndData=[{name:"song",data:a},{name:"cellComplete",data:s}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{var e=new i;e.init(t.data);var a=!1;setInterval(()=>{if(!a&&(a=1==e.generate(),soundsReady+=a,a)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)})}function M(t){for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)}function v(){switch(gamestate){case 0:r.clear(0,r.PAGE_1),r.renderTarget=r.PAGE_1,splodes.forEach(t=>{t.draw()}),r.text(["UNTITLED SPACE GAME",w/2-2,50,1,3,"center","top",3,7]),r.text([audioTxt,w/2-2,90,1,3,"center","top",1,22]),(l.justReleased(l.UP)||l.justReleased(l.w)||l.justReleased(l.z))&&(0==soundsReady?(g(),m()):(o(sounds.song,1,0,.3,!0),gamestate=1)),soundsReady==totalSounds?audioTxt="ALL SOUNDS LOADED.\nCLICK OR PRESS UP/W/Z TO CONTINUE":soundsReady>0?audioTxt="SOUNDS LOADING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nLOADING SEQUENCE",r.renderSource=r.PAGE_1,r.renderTarget=r.SCREEN,r.sspr(0,0,w,h,0,0,w,h,!1,!1),r.render();break;case 1:t+=1,view.x=p.x-mw,view.y=p.y-mh,splodes.forEach(t=>t.update()),planets.forEach(t=>t.update()),artifacts.forEach(t=>t.update()),p.update(),M(splodes),M(artifacts),r.clear(0,r.PAGE_1),r.renderTarget=r.PAGE_1,stars.forEach(t=>{n(t)&&r.pset(t.x-view.x,t.y-view.y,t.c)}),planets.forEach(t=>{t.draw()}),splodes.forEach(t=>t.draw()),artifacts.forEach(t=>t.draw()),p.draw(),collected.forEach((t,e)=>{r.rect(5+20*e,h-20,10,10,22),r.fillRect(5+20*e,h-20,10,10,t.color)}),r.renderSource=r.PAGE_1,r.renderTarget=r.SCREEN,r.sspr(0,0,w,h,0,0,w,h,!1,!1),r.render();break;case 2:gameover()}l.update(),requestAnimationFrame(v)}c.prototype.draw=function(){r.renderSource=r.PAGE_2,n(this,200)&&(r.tfillCircle(this.x-view.x,this.y-view.y,this.radius,this.color),r.circle(this.x-view.x,this.y-view.y,this.field,1))},c.prototype.update=function(){if(n(this,200)){let t=this.x-p.x,e=this.y-p.y;Math.sqrt(t*t+e*e)>this.field+p.radius||p.withinPlanetGravity||p.onPlanet(this)}},f.prototype.draw=function(){n(this,200)&&this.drawStack.forEach(t=>{r.fillRect(t.x-view.x,t.y-view.y,t.w,t.h,t.color)})},f.prototype.update=function(){if(n(this,200)){let t=this.x-p.x,e=this.y-p.y;if(Math.sqrt(t*t+e*e)<=this.radius+p.radius){this.alive=!1;for(let t=10;t>0;t--)splodes.push(new d(p.x+20*Math.random()-10,p.y+20*Math.random()-10,70*Math.random(),100*Math.random()));playSound(sounds.cellComplete),collected.push(this)}}},w=Math.floor(innerWidth/4),h=Math.floor(innerHeight/4),view={x:0,y:0},mw=w/2,mh=h/2,k=[],gamestate=0,paused=!1,p=u,p.x=3e3,p.y=3e3,atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRhoBAABXRUJQVlA4TA4BAAAvP8APENU4kQAATdrymm9oI7lrdY106y6No5GIbt01cXzBXRIPcIdnwNOcSgBAOs+zbaaXZiO5b2lfsVteWzfiVhmXXJGYrWrfubEAgFS+kW0doXa7xm7ByZ2iM3QTT8Zk2zZe/xMAIBCBIS0DigmoeYqiOnOnk8VofIwHXrD1sAsuh55+OZxLJIKVvGW6ol4A3kptn3iyKcMkfHrVBl8AOFLKE+04F3m4k6Qm7pZ47Vyaig5xcOzPIvzUurfH3yhZUwN1YfehdD+ixEvmeYlsD4b4QzDlTDaOW1yAx3drmvb7v7j30SbPrvhYExkRjs4i2hqWW/1Vu39dbgbsZkXQiYm7DvbeQL2LSZ//z3c=",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),console.log(atlas),window.r=new e(w,h,atlas,10),console.log(window.r),window.playSound=o,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),v()},window.t=1,splodes=[],planets=[],sndData=[],stars=[],collected=[],artifacts=[],sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="",window.addEventListener("keyup",t=>{l.onKeyup(t)},!1),window.addEventListener("keydown",t=>{l.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),onclick=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0==soundsReady?(g(),m()):soundsReady==totalSounds&&(gamestate=1,o(sounds.song,1,0,.3,!0))}}}();</script>